<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>caniuse api</title>
		<style>
		* { font-size: 100%; font-style: inherit; font-weight: inherit; margin: 0; }
		html { background: #F2F2F2; color: #333; font: 100%/1 sans-serif; }
		body { margin: 0 auto; width: 40em; }
		h1, section { margin: 2em 0; }
		h1 { font-size: 2em; font-weight: bold; }
		h2 { font-size: 1.5em; font-weight: bold; margin: 0.5em 0; }
		h3 { font-weight: bold; margin: 1em 0; }
		p { line-height: 1.5; margin: 0.5em 0; }
		em { color: #555; font-size: 75%; }
		var { background: #EEE; border: 1px solid #DDD; border-radius: 0.25em; font-style: italic; padding: 0.125em 0.25em; }
		code { font-family: monospace, monospace; }
		strong { font-weight: bold; }
		a { color: #55D; text-decoration: none; }

    #get-api h3 { margin: 1.5em 0 0.25em 0; }
    #features { display: block; width: 100%; }

    label[for='features'] { font-size: small; font-style: italic; }

    .formats label { text-transform: uppercase; }
    .formats label + label { padding: 0 1em;  }
    .formats label:first-of-type { padding-right: 1em; } 
    input[type="radio"], 
    input[type="checkbox"] { margin-right: 0.25em; }


    [id^='options'] { display: none; }

    [id^='options'].active { display: block; }

    [id^='options'] label, .callback { display: block; padding: 0.5em;  border-bottom: 1px dotted; }

    .api-example {
      background: #000;
      color: #fff;
      border-radius: 0.5em;
      font-family: monospace;
      padding: 0.5em 1em;
    }

    .api-example a {
      color: inherit;
      word-wrap: breakword;
    }

    .api-example a:hover {
      color: skyblue;
    }

		:target {
			-webkit-animation: glow 1.9s 3;  /* just twice */
			   -moz-animation: glow 1.9s 3;
			    -ms-animation: glow 1.9s 3;
		}
		@-webkit-keyframes glow { from { -webkit-box-shadow: 0 0 2px  hsl(176, 27%, 13%); }
		                          55% {  -webkit-box-shadow: 0 0 13px hsl(176, 27%, 13%); }
		                          to {   -webkit-box-shadow: 0 0 2px  hsl(176, 27%, 13%); } }
		@-moz-keyframes    glow { from {    -moz-box-shadow: 0 0 2px  hsl(176, 27%, 13%); }
		                          55% {     -moz-box-shadow: 0 0 13px hsl(176, 27%, 13%); }
		                          to {      -moz-box-shadow: 0 0 2px  hsl(176, 27%, 13%); } }
		@-ms-keyframes     glow { from {     -ms-box-shadow: 0 0 2px  hsl(176, 27%, 13%); }
		                          55% {      -ms-box-shadow: 0 0 13px hsl(176, 27%, 13%); }
		                          to {       -ms-box-shadow: 0 0 2px  hsl(176, 27%, 13%); } }
		</style>
	</head>
	<body>
		<h1>
      Support Browsers <b>with Feature Detection</b>
		</h1>

		<p>
      The caniuse API figures out which browsers are required based on the features you specify <small>(e.g.: WebGL and WebRTC)</small>. 
    </p>
    <p>
      You get back some HTML to show the user or a JSON object of the relevant data (with browser logos and all), so you can customize what you show to users.	
		</p>
    <section>
    <h2>Show Me</h2>
      <form id="get-api">
        <h3>You want data on browsers that support</h3>
        <label for="features">
          <input id="features" type="text" required value="json canvas">
          Separate each feature with a space, look at <a href="http://caniuse.com">caniuse</a> permalinks for feature names to use.
        </label>

        <div class="formats">
          <h3>as</h3>
          <label><input type="radio" name="format" value="json">json</label> or 
          <label><input type="radio" name="format" value="xml">xml</label> or
          <label><input type="radio" name="format" value="js">js</label> or
          <label><input type="radio" checked name="format" value="html">html</label>
        </div>

        <h3>with</h3>
        <div class='callback'>
          <input type="checkbox" id="callback" name="options" value="callback=callback">
          <input type="text" id="callbackvalue" value="callback">
        </div>
        <div id='options-html'>
          <label><input type="checkbox" name="options" value="nostyle">plain HTML, no styling</label>
          <label><input type="checkbox" name="options"  value="icon">Show browser logos</label>
          <label><input type="checkbox" name="options"  value="text">Show browser support information in text</label>
        </div>
        <div id='options-json'>
          <label><input type="checkbox" name="options" value="readable">Make it readable</label>
          <label><input type="checkbox" name="options" value="supported">Only output info on whether current browser supports these features</label>
        </div>
        <div id='options-js'>
          <label><input type="checkbox" name="options" value="noagent">Show All Supported Browsers</label>
        </div>
      </form>
      <article>
        <h3>
          Use
        </h3>
        <div class="api-example">
          <a href="#" id="url" target="_blank"></a>
        </div>

        <h3>
          To get
        </h3>
        <div id="result">
        </div> 
      </article>

    </section>
		<section>
			<h2>
				How to use
			</h2>
			<p>
				http://api.caniuse.com/<code>[ features ].[ format ][ ? [ options ] ]</code>
			</p>

			<p>You'll likely use JSON-P to grab this API, but you're welcome to use CORS.</p>

			<h3>
				features
			</h3>
			<p>
				The features <em>(<var>+</var> delimited)</em> to be tested, like <var>apng</var> or <var>canvas+json</var>.
			</p>
			<h3>
				format
			</h3>
			<p>
				The format the output will be returned as, like <var>json</var> or <var>xml</var>.
			</p>
			<h3>
				options
			</h3>
			<p>
				The options to be applied to the data, like <var>callback=myFunction</var> or <var>nostyle</var>.
			</p>

		</section>
		<section>
			<h2>
				Examples
			</h2>
			<p>
				<code><a href="svg.html">svg.html</a></code>: displays the results of an <var>svg</var> feature test as a button in HTML.
			</p>
			<p>
				<code><a href="canvas+json.js?callback=myFunction">canvas+json.js?callback=myFunction</a></code>: displays the results of a <var>canvas+json</var> feature test in JavaScript, wrapped in a JSONP <var>myFunction</var> callback.
			</p>
			<p>
				<code><a href="apng.html?texticon">apng.html?texticon</a></code>: displays the results of a <var>apng</var> feature test as text with icons in HTML.
			</p>
		</section>
		<section>
			<h2>
				Formats
			</h2>
			<p>
				<code><strong>html</strong></code>: the output will be valid HTML with the mimetype of <var>text/html</var>.
			</p>
			<p>
				<code><strong>js</strong></code>: the output will be valid JavaScript with the mimetype of <var>text/javascript</var>.
			</p>
			<p>
				<code><strong>json</strong></code>: the output will be valid JSON with the mimetype of <var>text/json</var>.
			</p>
			<p>
				<code><strong>xml</strong></code>: the output will be valid XML with the mimetype of <var>text/xml</var>.
			</p>
		</section>
		<section>
			<h2 id=options>
				Options
			</h2>
			<p>
				<code><strong>button</strong></code>: the default, the HTML will be optimized for button output.
			</p>
			<p>
				<code><strong>callback = [ functionName ]</strong></code>: the output will be JavaScript, wrapped in this function name.
			</p>
			<p>
				<code><strong>icon</strong></code>: the HTML will be optimized for icon output.
			</p>
			<p>
				<code><strong>noagent</strong></code>: the JS will return results for all browsers with no agent detection.
			</p>
			<p>
				<code><strong>nostyle</strong></code>: the HTML will not include the stylesheet.
			</p>
			<p>
				<code><strong>readable</strong></code>: the JSON will be formatted for readability.
			</p>
			<p>
				<code><strong>supported</strong></code>: the JSON will only output whether the agent supports the requested features.
			</p>
			<p>
				<code><strong>text</strong></code>: the HTML will be optimized for text output.
			</p>
			<p>
				<code><strong>texticon</strong></code>: the HTML will be optimized for text and icon output.
			</p>
		</section>
		<section>
			<h2 id=contribute>
				Contribute
			</h2>
			<p>
				This is a community project. You can <a href="//github.com/jonathantneal/caniuse">help by forking caniuse</a> and making it better. Please also file a ticket to start a discussion.
			</p>
			<p>
				There is no guarantee this API will continue to work, but there is hope.
			</p>
		</section>
		<footer>
			<h2 id=credit>
				Credit
			</h2>
			<p>
				This API was made with love by <a href="//twitter.com/jon_neal">Jon Neal</a>. The project was initiated over at <a href="github.com/paulirish/lazyweb-requests/issues/39">github.com/paulirish/lazyweb-requests#39</a> and corraled by Divya Manian and Paul Irish with input from other lovers of the open web.
			</p>
			<p>
				The original caniuse data was made by the one and only <a href="//twitter.com/fyrd">Alexis Deveria</a> and the glamorous buttons were made by the dapper <a href="//twitter.com/aaronlayton">Aaron Layton</a>. This project was inspired by <a href="//get.webgl.org/">get.webgl.org</a>.
			</p>

		</footer>
		<script>
      var url = document.getElementById('url'),
         result = document.getElementById('result'),
         features = document.getElementById('features'),
         formats = document.querySelectorAll('input[name="format"]'),
         options = document.querySelectorAll('input[name="options"]'),
         callbackvalue = document.getElementById('callbackvalue'),
         callback = document.getElementById('callback'),
         cache = {}, lastActive = false;


         var api = {
          'domain': 'http://api.caniuse.com/',
          'features': '',
          'format': '',
          'options': ''
          } 

      features.onblur = function() {
         api.features = features.value.split(' ').join('+').trim(); 
         refreshOutput();
      };

      callbackvalue.onblur = function() {
        callback.value = 'callback=' + this.value;
        if(callback.checked) {
          refreshOutput();
        }
      };

      [].forEach.call(formats, function(format) {
       format.onclick =  function() {
         api.format = this.value;
         showFormatOptions();
         refreshOutput();
       };
      });

      [].forEach.call(options, function(option) {
        option.onchange =  function() {
          refreshOutput();
        };
      });
       
      function showFormatOptions() {
        if (lastActive.className) { lastActive.className = '' };
        api.options = '';
        var formatOptions = document.getElementById('options-'+ api.format);
        if(formatOptions) { 
          formatOptions.className = 'active'; 
          lastActive = formatOptions;
        }
      }

      function formattedOptions() {
        var currentOptions = document.getElementById('options-' + api.format).querySelectorAll('input[name="options"]') || [];
        currentOptions = [].filter.call(currentOptions, function(option) { return option.checked; }).map(function(option) { return option.value; });

        if(callback.checked) {
          currentOptions.push(callback.value);
        }

        return currentOptions.join('&');
        
      };

      function refreshOutput() {
         if(api.features !== '') {
           api.options = formattedOptions();
           updateurl();
           updateresult();
         }
      };

      function updateurl() {
        url.textContent = Object.keys(api).map(function(key) { 
          var operator = '';
          if(key === 'format') {
           operator = '.'; 
           } else if (key === 'options') {
              operator = '?';
            } 
            return operator + api[key];
          }).join(''); 

        url.href = url.textContent;
       
      };

      function updateresult() {
        cacheresult = cache[url.textContent];
        if(cacheresult) {
          if(api.format == 'html') {
            result.innerHTML = cacheresult;
            } else {
            textarea.value = cacheresult;
            result.appendChild(textarea);

          }
          } else {
          var request = new XMLHttpRequest();
          request.onreadystatechange = function() {
            if(request.readyState === 4) {
              if(request.status === 200) {
                cache[url.textContent] = request.responseText.toString(); 
              }
            }  
          };
        
          request.open('GET', url.textContent);
          request.send();
        } 
      };

      api.features = features.value.split(' ').join('+');
      api.format = document.querySelector('input[name="format"][checked]').value; 
      showFormatOptions();
      refreshOutput();

		</script>
	</body>
</html>
